const bcrypt = require('bcrypt');

app.post('/signup', (req, res) => {
  const { name, username, email, age, password, confirmPassword } = req.body;

  // Check if passwords match
  if (password !== confirmPassword) {
    req.flash('signupMessage', 'Passwords do not match');
    return res.redirect('/signup');
  }

  // Hash the password
  bcrypt.hash(password, 10, (err, hashedPassword) => {
    if (err) throw err;

    // Store user data in the database
    const newUser = {
      name,
      username,
      email,
      age,
      password: hashedPassword,
    };

    // Insert newUser into the database
    db.query('INSERT INTO users SET ?', newUser, (err, result) => {
      if (err) {
        req.flash('signupMessage', 'User registration failed');
        res.redirect('/signup');
      } else {
        req.flash('loginMessage', 'Registration successful. Please log in.');
        res.redirect('/login');
      }
    });
  });
});

